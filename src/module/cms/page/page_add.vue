<template>
  <div>
    <el-form :model="pageForm" :rules="pageFormRules" label-width="80px" ref="pageForm">
      <el-form-item label="所属站点" prop="siteId">
        <el-select v-model="pageForm.siteId" placeholder="请选择站点">
          <el-option v-for = "item in siteList"
                     :key = "item.siteId"
                     :label="item.siteName"
                     :value="item.siteId">
          </el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="选择模板" prop="templateId">
      <el-select v-model="pageForm.templateId" placeholder="请选择">
      <el-option v-for = "item in templateList"
                 :key = "item.templateId"
                 :label="item.templateName"
                 :value="item.templateId">
      </el-option>
    </el-select>
   </el-form-item>
      <el-form-item label="页面名称" prop="pageName">
        <el-input v-model="pageForm.pageName" auto-complete="off"></el-input>
      </el-form-item>
      <el-form-item label="别名" prop="pageAliase">
        <el-input v-model="pageForm.pageAliase" auto-complete="off"></el-input>
      </el-form-item>
      <el-form-item label="访问路径" prop="pageWebPath">
        <el-input v-model="pageForm.pageWebPath" auto-complete="off"></el-input>
      </el-form-item>
      <el-form-item label="物理路径" prop="pagePhysicalPath">
        <el-input v-model="pageForm.pagePhysicalPath" auto-complete="off"></el-input>
      </el-form-item>
      <el-form-item label="类型">
        <el-radio-group v-model="pageForm.pageType">
          <el-radio class="radio" label=1>静态</el-radio>
          <el-radio class="radio" label=2>动态</el-radio>
        </el-radio-group>
      </el-form-item>
      <el-form-item label="创建时间">
        <el-date-picker type="datetime" placeholder="选择日期时间" v-model="pageForm.pageCreateTime">
        </el-date-picker>
      </el-form-item>
    </el-form>
    <div slot="footer" class="dialog-footer">
      <el-button type="primary" size="small" v-on:click="addSubmit">提交</el-button>
      <el-button type="primary" size="small" v-on:click="go_back">返回</el-button>
    </div>
  </div>
</template>
<script>
/*编写页面静态部分，即model及vm部分。*/
import * as cmsApi from '../api/cms'
export default {
  data() {
    return {
      siteList: [], //站点列表
      templateList: [], //模板列表
      //新增界面数据
      pageForm:{
        siteId:'', //站点id
        templateId:'', //模板id
        pageName:'', //页面名称
        pageAliase:'', //页面别名
        pageWebPath:'', //访问路径
        pagePhysicalPath:'', //物理路径
        pageType:'', //页面类型
        pageCreateTime:new Date() //页面创建时间
      }
    }
  },
  methods:{
    //提交按钮
    addSubmit(){
      this.$refs.pageForm.validate((valid) => {
        if(valid){
          this.$confirm('确认提交吗?','提示',{}).then(() =>{
            cmsApi.page_add(this.pageForm).then((res) =>{
              console.log(res);
              if(res.success){
                this.$message({
                  message: '提交成功',
                  type: 'success'
                });
              }else {
                this.$message.error('提交失败');
              }
            });
          });
        }else {
          alert("校验失败");
          return false;
        }
      })
    },
    //返回按钮
    go_back(){
      this.$router.push({
        path: '/cms/page/list',query: {
          page: this.$route.query.page,
          siteId: this.$route.query.siteId
        }
      })
    },
    //表单数据校验
    pageFormRules: {
      siteId:[
        {required: true, message: '请选择站点',trigger: 'blur'}
      ],
      templateId:[
        {required: true, message: '请选择模板',trigger: 'blur'}
      ],
      pageName:[
        {required: true, message: '请输入页面名称',trigger: 'blur'}
      ],
      pageWebPath:[
        {required: true, message: '请输入访问路径',trigger: 'blur'}
      ],
      pagePhysicalPath:[
        {required: true, message: '请输入物理路径',trigger: 'blur'}
      ]
    }
  },
  //进入页面即查询
  created:function (){
    //初始化站点列表
    this.siteList =[
      {
        siteId:'5a751fab6abb5044e0d19ea1',
        siteName:'首页'
      },
      {
        siteId:'5a751fab6abb5044e0d19ea1',
        siteName:'轮播图'
      }
    ]
      //初始化模板列表
      this.templateList = [
        {
          templateId: '5aec5dd70e661808240ab7a6',
          templateName: '模板名称1'
        },
        {
          templateId: '5ad9a24d68db5239b8fef199',
          templateName: '模板名称2'
        }
      ]
  }
}
</script>
<style>
/*编写页面样式，不是必须*/
</style>
